<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Novelist Tools</title>

  <!-- PWA manifest & theme color -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0097a7">
  <link rel="icon" href="icons/icon-192.png" type="image/png">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    /* === common reset & UI styles === */
    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      margin:0; padding:0;
      background:linear-gradient(135deg,#1a1a1a,#0a0a0a);
      color:#e0e0e0; -webkit-font-smoothing:antialiased;
      font-size:16px; line-height:1.6;
    }
    header {
      display:flex; align-items:center;
      background:#111; padding:15px 20px;
      position:sticky; top:0; z-index:10;
    }
    .menu-toggle { font-size:24px; cursor:pointer; margin-right:20px; }
    .title { font-size:20px; font-weight:bold; color:#fff; }

    /* sidebar (hidden offscreen right until .open) */
    .sidebar {
      position:fixed; top:0; right:0;
      width:240px; height:100%; padding:20px;
      background:#222; box-shadow:-2px 0 8px rgba(0,0,0,0.5);
      transform:translateX(100%); transition:transform .3s ease;
      z-index:20; overflow-y:auto;
    }
    .sidebar.open { transform:translateX(0); }
    .sidebar h2 { color:#fff; margin:0 0 20px; }
    .sidebar button {
      width:100%; margin-bottom:15px; padding:12px;
      border:none; border-radius:8px;
      background:linear-gradient(135deg,#26c6da,#0097a7);
      color:#fff; font-size:16px; cursor:pointer;
      transition:all .3s;
    }
    .sidebar button:hover {
      transform:translateY(-2px);
      box-shadow:0 8px 16px rgba(255,255,255,0.1);
    }

    .container {
      max-width:480px; margin:20px auto; padding:0 20px;
    }
    .card {
      background:linear-gradient(145deg,#2a2a2a,#202020);
      padding:30px; border-radius:18px;
      box-shadow:0 4px 15px rgba(0,0,0,0.3),0 2px 6px rgba(0,0,0,0.2);
    }
    h1 {
      color:#fff; text-align:center;
      font-size:28px; margin-bottom:25px;
      text-shadow:0 2px 6px rgba(0,0,0,0.3);
    }

    .btn {
      width:100%; max-width:340px; margin:10px auto;
      padding:14px 30px; border:none; border-radius:12px;
      cursor:pointer; font-size:16px; font-weight:500;
      text-align:center; color:white;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
      transition:all .3s cubic-bezier(.25,.8,.25,1);
      display:block; box-sizing:border-box;
    }
    .btn:disabled {
      opacity:.6; cursor:not-allowed; transform:none;
      box-shadow:none;
    }

    /* EPUB Splitter buttons */
    .upload-btn { background:linear-gradient(135deg,#7e57c2,#5e37b5); }
    .split-btn  { background:linear-gradient(135deg,#26c6da,#0097a7); }
    .download-btn{ background:linear-gradient(135deg,#ff7043,#e64a19); }

    .mode-section, .options-section {
      text-align:center; margin-bottom:25px;
    }
    .mode-section select,
    .option-group input {
      background:#2e2e2e; border:2px solid transparent;
      border-radius:8px; padding:12px; font-size:14px;
      color:#e0e0e0; width:100%; max-width:300px;
      margin:10px auto 0; box-sizing:border-box;
      transition:border-color .3s, box-shadow .3s;
    }
    .option-group { margin-bottom:15px; }
    .option-group label { color:#ffffffcc; margin-bottom:8px; display:block; }

    .spinner, .spinner-backup {
      border:5px solid rgba(255,255,255,0.1);
      border-top:5px solid #4a90e2;
      border-radius:50%; width:45px; height:45px;
      animation:spin 1.2s linear infinite;
      margin:20px auto; display:none;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    #statusMessage {
      border-radius:10px; padding:16px;
      margin-top:20px; animation:slideIn .3s ease-out;
    }
    @keyframes slideIn { from { opacity:0; transform:translateY(20px);} to { opacity:1; transform:translateY(0);} }

    /* Backup tool */
    .operation-selector, .operation-section { margin-bottom:25px; }
    select, input[type="text"], input[type="number"], input[type="file"], textarea {
      width:100%; padding:12px; margin-bottom:15px;
      background:#2e2e2e; border:2px solid transparent;
      border-radius:8px; color:#e0e0e0; font-size:14px;
      box-sizing:border-box; transition:border-color .3s, box-shadow .3s;
    }
    textarea { resize:vertical; min-height:80px; }
    .btn-primary { background:linear-gradient(135deg,#26c6da,#0097a7); }
    .btn-accent  { background:linear-gradient(135deg,#7e57c2,#5e37b5); }

    .status-toast {
      position:fixed; bottom:20px; left:50%;
      transform:translateX(-50%);
      padding:14px 24px; border-radius:8px;
      color:#fff; font-size:14px;
      opacity:0; pointer-events:none;
      transition:opacity .3s;
      z-index:1000;
    }
    .toast-success { background:#38a86d; }
    .toast-error   { background:#ff6b6b; }
  </style>
</head>

<body>
  <header>
    <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
    <div class="title" id="appTitle">EPUB Chapter Splitter</div>
  </header>

  <div class="sidebar" id="sidebar">
  <h2>Select Tool</h2>
  <button onclick="switchApp('splitter')">EPUB Chapter Splitter</button>
  <button onclick="switchApp('backup')">Novel Backup Utility</button>
  <button onclick="switchApp('zipToEpub')">ZIP to EPUB Converter</button> <!-- NEW -->
  <button onclick="switchApp('epubToZip')">EPUB to ZIP (TXT)</button>
</div>

  <div class="container">
    <!-- EPUB Splitter -->
    <div id="splitterApp" class="card">
      <h1>EPUB Chapter Splitter</h1>
      <div class="upload-section">
        <label for="epubUpload" class="btn upload-btn">Upload EPUB File</label>
        <input type="file" id="epubUpload" accept=".epub" style="display:none;">
        <div id="epubFileName" style="margin-top:10px;font-size:14px;color:#ccc;text-align:center;"></div>
      </div>
      <div class="mode-section">
        <label for="modeSelect">Output Mode:</label>
        <select id="modeSelect">
          <option value="single">Single Chapter per File</option>
          <option value="grouped">Grouped Chapters per File</option>
        </select>
      </div>
      <div class="options-section">
        <div class="option-group">
          <label for="chapterPattern">Chapter Prefix:</label>
          <input type="text" id="chapterPattern" placeholder="e.g., test" value="test">
        </div>
        <div class="option-group">
          <label for="startNumber">Start Number:</label>
          <input type="number" id="startNumber" min="1" value="1">
        </div>
        <div class="option-group">
          <label for="offsetNumber">Offset (skip chapters):</label>
          <input type="number" id="offsetNumber" min="0" value="0">
        </div>
        <div class="option-group" id="groupSizeGroup" style="display:none;">
          <label for="groupSize">Chapters per File:</label>
          <input type="number" id="groupSize" min="1" value="4">
        </div>
      </div>
      <button id="splitBtn" class="btn split-btn" disabled>Split EPUB</button>
      <div id="spinnerSplitter" class="spinner"></div>
      <div id="statusMessage" class="status" style="display:none;"></div>
      <div class="download-section" style="display:none;">
        <a id="downloadLink" class="btn download-btn">Download Chapters</a>
      </div>
    </div>

    <!-- Backup Utility -->
    <div id="backupApp" class="card" style="display:none;">
      <h1>Novel Backup File Utility</h1>
      <div class="operation-selector">
        <label for="operationSelect">Select Operation:</label>
        <select id="operationSelect">
          <option value="create">Create New Backup File</option>
          <option value="createFromZip">Create Backup from ZIP</option>
          <option value="extend">Extend Existing Backup File</option>
          <option value="merge">Merge Backup Files</option>
          <option value="findReplace">Find &amp; Replace</option>
        </select>
      </div>


      <!-- Create -->
      <div id="createSection" class="operation-section">
        <h2>Create New Backup File</h2>
        <label for="createProjectTitle">Project Title:</label>
        <input type="text" id="createProjectTitle" placeholder="Enter project title">
        <label for="createDescription">Description:</label>
        <textarea id="createDescription" placeholder="Enter project description"></textarea>
        <label for="createUniqueCode">Unique Code (Optional):</label>
        <input type="text" id="createUniqueCode" placeholder="Leave blank to generate automatically">
        <label for="createChapters">Number of Chapters:</label>
        <input type="number" id="createChapters" min="1" value="3">
        <label for="createPrefix">Prefix for Chapter Titles:</label>
        <input type="text" id="createPrefix" placeholder="e.g., Chapter ">
        <label for="createTOC">Show Table of Contents:</label>
        <select id="createTOC">
          <option value="true">True</option>
          <option value="false">False</option>
        </select>
        <label for="createIndentation">Automatic Indentation:</label>
        <select id="createIndentation">
          <option value="true">True</option>
          <option value="false">False</option>
        </select>
        <button id="createBtn" class="btn btn-primary">Generate and Download</button>
      </div>

      <!-- Create from ZIP -->
      <div id="createFromZipSection" class="operation-section" style="display:none;">
        <h2>Create Backup from ZIP File</h2>
        <label for="zipBackupFile">Upload ZIP File (.zip containing .txt chapters):</label>
        <input type="file" id="zipBackupFile" accept=".zip">

        <label for="zipProjectTitle">Project Title:</label>
        <input type="text" id="zipProjectTitle" placeholder="Enter project title">
        <label for="zipDescription">Description:</label>
        <textarea id="zipDescription" placeholder="Enter project description"></textarea>
        <label for="zipUniqueCode">Unique Code (Optional):</label>
        <input type="text" id="zipUniqueCode" placeholder="Leave blank to generate automatically">
        
        <label for="zipCreateTOC">Show Table of Contents:</label>
        <select id="zipCreateTOC">
          <option value="true">True</option>
          <option value="false">False</option>
        </select>
        <label for="zipCreateIndentation">Automatic Indentation:</label>
        <select id="zipCreateIndentation">
          <option value="true">True</option>
          <option value="false">False</option>
        </select>
        <button id="createFromZipBtn" class="btn btn-primary">Generate Backup and Download</button>
      </div>

      <!-- Extend -->
      <div id="extendSection" class="operation-section" style="display:none;">
        <h2>Extend Existing Backup File</h2>
        <label for="extendBackupFile">Upload Backup File:</label>
        <input type="file" id="extendBackupFile" accept=".json,.txt">
        <label for="extendExtraChapters">Extra Empty Chapters:</label>
        <input type="number" id="extendExtraChapters" min="1" value="200">
        <label for="extendPrefix">Prefix for New Chapters:</label>
        <input type="text" id="extendPrefix" placeholder="e.g., Chapter ">
        <button id="extendBtn" class="btn btn-primary">Extend and Download</button>
      </div>

      <!-- Merge -->
      <div id="mergeSection" class="operation-section" style="display:none;">
        <h2>Merge Backup Files</h2>
        <label for="mergeProjectTitle">Merged Project Title:</label>
        <input type="text" id="mergeProjectTitle" placeholder="Enter merged project title">
        <label for="mergeDescription">Merged Description:</label>
        <textarea id="mergeDescription" placeholder="Enter merged project description"></textarea>
        <label for="mergeBackupFiles">Upload Backup Files:</label>
        <input type="file" id="mergeBackupFiles" accept=".json,.txt" multiple>
        <label for="mergePrefix">Prefix for Chapters:</label>
        <input type="text" id="mergePrefix" placeholder="e.g., Chapter ">
        <button id="mergeBtn" class="btn btn-primary">Merge and Download</button>
      </div>

      <!-- Find & Replace -->
      <div id="findReplaceSection" class="operation-section" style="display:none;">
        <h2>Find &amp; Replace in Backup File</h2>
        <label for="frBackupFile">Upload Backup File:</label>
        <input type="file" id="frBackupFile" accept=".json,.txt">
        <label for="findPattern">Find Pattern:</label>
        <input type="text" id="findPattern" placeholder="Enter search term or regex">
        <label for="replaceText">Replacement Text:</label>
        <input type="text" id="replaceText" placeholder="Enter replacement text">
        <label><input type="checkbox" id="useRegex"> Use Regular Expressions</label>
        <div style="display:flex; gap:10px; margin:15px 0;">
          <button id="findPreviousBtn" class="btn btn-primary">Find Previous</button>
          <button id="findNextBtn" class="btn btn-primary">Find Next</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
          <button id="replaceNextBtn" class="btn btn-primary">Replace This</button>
          <button id="replaceAllBtn" class="btn btn-primary">Replace All &amp; Download</button>
        </div>
        <div id="currentMatchDisplay" style="
             background:#2e2e2e; padding:12px; border-radius:8px;
             min-height:50px; white-space:pre-wrap; color:#e0e0e0;">
          No match found yet.
        </div>
      </div>
      
      <div id="spinnerBackup" class="spinner-backup"></div>
    </div>
       <!-- ZIP to EPUB Converter -->
      <div id="zipToEpubApp" class="card" style="display:none;">
        <h1>ZIP to EPUB Converter</h1>
        <div class="upload-section">
          <label for="zipUploadForEpub" class="btn upload-btn">Upload ZIP File (.zip with .txt chapters)</label>
          <input type="file" id="zipUploadForEpub" accept=".zip" style="display:none;">
          <div id="zipFileNameForEpub" style="margin-top:10px;font-size:14px;color:#ccc;text-align:center;"></div>
        </div>

        <div class="options-section">
          <div class="option-group">
            <label for="epubTitle">EPUB Title:</label>
            <input type="text" id="epubTitle" placeholder="Enter EPUB title" value="My Novel">
          </div>
          <div class="option-group">
            <label for="epubAuthor">Author:</label>
            <input type="text" id="epubAuthor" placeholder="Enter author name" value="Unknown Author">
          </div>
          <div class="option-group">
            <label for="epubLanguage">Language Code (e.g., en, es):</label>
            <input type="text" id="epubLanguage" placeholder="en" value="en">
          </div>
          <div class="option-group">
              <label for="epubCoverImage">Cover Image (Optional, JPG/PNG):</label>
              <input type="file" id="epubCoverImage" accept="image/jpeg,image/png" style="margin-top:5px;">
              <div id="epubCoverFileName" style="margin-top:5px;font-size:12px;color:#aaa;text-align:center;"></div>
          </div>
        </div>

        <button id="createEpubBtn" class="btn split-btn" disabled>Create EPUB</button> <!-- Using split-btn style for now -->
        <div id="spinnerZipToEpub" class="spinner"></div> <!-- Using common spinner style -->
        <div id="statusMessageZipToEpub" class="status" style="display:none;"></div>
        <div class="download-section" id="downloadSectionZipToEpub" style="display:none;">
          <a id="downloadLinkEpub" class="btn download-btn">Download EPUB</a>
        </div>
      </div>

      <!-- EPUB to ZIP (TXT) Converter -->
      <div id="epubToZipApp" class="card" style="display:none;">
        <h1>EPUB to ZIP (TXT)</h1>
        <div class="upload-section">
          <label for="epubUploadForTxt" class="btn upload-btn">Upload EPUB File</label>
          <input type="file" id="epubUploadForTxt" accept=".epub" style="display:none;">
          <div id="epubFileNameForTxt" style="margin-top:10px;font-size:14px;color:#ccc;text-align:center;"></div>
        </div>

        <button id="extractChaptersBtn" class="btn split-btn" disabled>Extract Chapters to ZIP</button>
        <div id="spinnerEpubToZip" class="spinner"></div>
        <div id="statusMessageEpubToZip" class="status" style="display:none;"></div>
        <div class="download-section" id="downloadSectionEpubToZip" style="display:none;">
          <a id="downloadLinkZipFromEpub" class="btn download-btn">Download Chapter TXTs</a>
        </div>
      </div>
  </div>

  <!-- Install button -->
  <button id="installBtn" style="
    display:none;
    position:fixed; bottom:20px; right:20px;
    padding:12px 18px; background:#0097a7;
    color:white; border:none; border-radius:8px;
    font-size:16px; cursor:pointer;
  ">Install App</button>

  <div id="toast" class="status-toast"></div>

  <!-- JSZip -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

  <script>
  
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script type="module" src="js/main.js"></script> <!-- NEW -->
</body>
</body>
</html>
